<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="app" v-if="show" :style="containerStyle" @mousedown="bringToFront">

        <!--  SIDEBAR PREMIUM -->
        <aside class="sidebar" @mousedown="startDrag">
            <div class="logo-container">
                <div class="logo-icon"><i class="fas fa-store"></i></div>
                <h4 class="logo-text">SHOP <span class="gradient-text">CREATOR</span></h4>
                <div class="logo-subtitle">Professional Edition</div>
            </div>

            <div class="nav-menu" @mousedown.stop>
                <button class="nav-btn" :class="{active: view === 'manage'}" @click="view = 'manage'">
                    <span class="nav-icon"><i class="fas fa-list"></i></span>
                    <span class="nav-label">
                        <div class="nav-title">Gesti贸n</div>
                        <div class="nav-desc">Administrar tiendas</div>
                    </span>
                    <span class="badge-count">{{ shops.length }}</span>
                </button>

                <button class="nav-btn" :class="{active: view === 'create'}" @click="resetCreator">
                    <span class="nav-icon"><i class="fas fa-plus"></i></span>
                    <span class="nav-label">
                        <div class="nav-title">Crear Nueva</div>
                        <div class="nav-desc">Configurar tienda</div>
                    </span>
                    <span class="badge-new">NEW</span>
                </button>
            </div>

            <div class="mt-auto settings-panel" @mousedown.stop>
                <div class="setting-item">
                    <label class="setting-label">
                        <i class="fas fa-search-plus me-2"></i> Escala UI
                    </label>
                    <input type="range" class="form-range range-slider" min="0.7" max="1.3" step="0.05"
                        v-model.number="ui.scale" @input="saveSettings">
                    <div class="setting-value">{{ (ui.scale * 100).toFixed(0) }}%</div>
                </div>

                <button class="btn-close-app" @click="closeUI">
                    <i class="fas fa-times-circle me-2"></i> Cerrar
                </button>
            </div>
        </aside>

        <!--  CONTENIDO PRINCIPAL -->
        <main class="main-content">
            <header class="header-bar">
                <div class="header-content">
                    <h5 v-if="view === 'create'" class="header-title">
                        <span class="step-indicator">Paso {{ step }}/4</span>
                        <span class="header-subtitle">
                            {{ isEditMode ? 'Editar Tienda #' + editingShopId : 'Nueva Tienda' }}
                        </span>
                    </h5>
                    <h5 v-else class="header-title">
                        <i class="fas fa-store me-2"></i> Gesti贸n de Tiendas
                    </h5>
                </div>
                <div class="header-actions">
                    <div class="status-indicator">
                        <i class="fas fa-circle pulse"></i> En L铆nea
                    </div>
                </div>
            </header>

            <div class="content-body">

                <!--  CREACIN DE TIENDA -->
                <div v-if="view === 'create'" class="creator-container">

                    <!-- PASO 1: Informaci贸n B谩sica -->
                    <div v-if="step === 1" class="step-content fade-in">
                        <div class="step-header">
                            <div class="step-icon"><i class="fas fa-info-circle"></i></div>
                            <h3>Informaci贸n B谩sica</h3>
                            <p>Configura el nombre y tipo de tu negocio</p>
                        </div>

                        <div class="form-card">
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-tag me-2"></i> Nombre de Tienda</label>
                                <input type="text" class="form-input" v-model="form.name"
                                    placeholder="Ej: Tienda Central">
                            </div>

                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-building me-2"></i> Tipo de Negocio</label>
                                <div class="type-grid">
                                    <button class="type-card" :class="{active: form.type === t.value}"
                                        v-for="t in shopTypes" @click="form.type = t.value">
                                        <div class="type-icon"><i :class="'fas ' + t.icon"></i></div>
                                        <div class="type-label">{{ t.label }}</div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- PASO 2: Selecci贸n de NPC -->
                    <div v-if="step === 2" class="step-content fade-in">
                        <div class="step-header">
                            <div class="step-icon"><i class="fas fa-user-tie"></i></div>
                            <h3>Modelo de Vendedor</h3>
                            <p>Selecciona el NPC que atender谩 la tienda</p>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-4">
                                <div class="preview-card">
                                    <div class="preview-icon"><i class="fas fa-user-tie"></i></div>
                                    <h5 class="preview-title">{{ getPedLabel(form.pedModel) }}</h5>
                                    <div class="preview-model">{{ form.pedModel }}</div>
                                    <div class="preview-badge">
                                        <i class="fas fa-eye me-1"></i> Preview In-Game
                                    </div>
                                </div>
                                <div class="alert-info">
                                    <i class="fas fa-lightbulb me-2"></i> El NPC aparecer谩 frente a tu personaje
                                </div>
                            </div>

                            <div class="col-md-8">
                                <input type="text" v-model="pedSearch" class="search-input"
                                    placeholder=" Buscar modelo de NPC...">

                                <div class="ped-list-container">
                                    <div v-for="cat in filteredPeds" class="ped-category">
                                        <div class="category-header">{{ cat.category }}</div>
                                        <div class="ped-list">
                                            <button v-for="ped in cat.peds" class="ped-item"
                                                :class="{active: form.pedModel === ped.model}"
                                                @click="selectPed(ped.model)">
                                                <span class="ped-label">{{ ped.label }}</span>
                                                <span class="ped-model">{{ ped.model }}</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- PASO 3: Selecci贸n de Items -->
                    <div v-if="step === 3" class="step-content fade-in">
                        <div class="step-header">
                            <div class="step-icon"><i class="fas fa-boxes"></i></div>
                            <h3>Inventario de Productos</h3>
                            <p>Selecciona los items que vender谩s</p>
                        </div>

                        <div class="items-header">
                            <input type="text" v-model="itemSearch" class="search-input"
                                placeholder=" Buscar productos...">
                            <div class="items-counter">
                                <span class="counter-badge">{{ form.items.length }}</span> Items Seleccionados
                            </div>
                        </div>

                        <div class="accordion" id="accItems">
                            <div class="category-accordion" v-for="(cat, idx) in itemCategories">
                                <div class="accordion-header" data-bs-toggle="collapse" :data-bs-target="'#c'+idx">
                                    <div class="accordion-title">
                                        <i class="fas fa-folder me-2"></i> {{ cat.label }}
                                    </div>
                                    <div class="accordion-count">{{ getCategoryItems(cat.id).length }}</div>
                                </div>
                                <div :id="'c'+idx" class="accordion-collapse collapse" data-bs-parent="#accItems">
                                    <div class="items-grid">
                                        <div class="item-card" v-for="item in getCategoryItems(cat.id)"
                                            :class="{selected: isSelected(item.name)}" @click="toggleItem(item)">
                                            <img :src="imgDir + item.image" class="item-img" @error="handleImgErr">
                                            <div class="item-info">
                                                <div class="item-name">{{ item.label }}</div>
                                                <div class="item-code">{{ item.name }}</div>
                                            </div>
                                            <div v-if="isSelected(item.name)" class="item-price" @click.stop>
                                                <div class="price-input-group">
                                                    <span class="price-symbol">$</span>
                                                    <input type="number" class="price-input"
                                                        v-model.number="getItem(item.name).price">
                                                </div>
                                            </div>
                                            <div v-if="isSelected(item.name)" class="item-checkmark">
                                                <i class="fas fa-check"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- PASO 4: Configuraci贸n de Blip -->
                    <div v-if="step === 4" class="step-content fade-in">
                        <div class="step-header">
                            <div class="step-icon"><i class="fas fa-map-marked-alt"></i></div>
                            <h3>Marcador en Mapa</h3>
                            <p>Configura c贸mo aparecer谩 tu tienda en el mapa</p>
                        </div>

                        <div class="blip-toggle">
                            <input class="toggle-checkbox" type="checkbox" id="blipToggle" v-model="form.blip.enable"
                                @change="previewBlip">
                            <label class="toggle-label" for="blipToggle">
                                <span class="toggle-text">Mostrar en Mapa</span>
                            </label>
                        </div>

                        <div v-if="form.blip.enable" class="blip-config fade-in">
                            <h6 class="config-subtitle">Estilos Predefinidos</h6>
                            <div class="blip-grid">
                                <div class="blip-preset" v-for="preset in blipPresets"
                                    :class="{active: form.blip.sprite == preset.sprite && form.blip.color == preset.color}"
                                    @click="selectBlip(preset)">
                                    <div class="blip-icon" :class="'blip-color-' + preset.color">
                                        <i class="fas fa-map-marker-alt"></i>
                                        <span class="blip-sprite">{{ preset.sprite }}</span>
                                    </div>
                                    <div class="blip-label">{{ preset.label }}</div>
                                </div>
                            </div>

                            <div class="custom-blip">
                                <h6 class="config-subtitle">Personalizado</h6>
                                <div class="row g-3">
                                    <div class="col-6">
                                        <label class="form-label-sm">Sprite ID</label>
                                        <input type="number" class="form-input-sm" v-model.number="form.blip.sprite"
                                            @input="previewBlip">
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label-sm">Color ID</label>
                                        <input type="number" class="form-input-sm" v-model.number="form.blip.color"
                                            @input="previewBlip">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- NAVEGACIN DE PASOS -->
                    <div class="step-navigation">
                        <button class="btn-step btn-back" @click="step--" v-if="step > 1">
                            <i class="fas fa-arrow-left me-2"></i> Atr谩s
                        </button>
                        <div v-else></div>

                        <button class="btn-step btn-next" @click="step++" v-if="step < 4" :disabled="!canNext">
                            Siguiente <i class="fas fa-arrow-right ms-2"></i>
                        </button>
                        <button class="btn-step btn-finish" @click="isEditMode ? updateShop() : finish()"
                            v-if="step === 4">
                            <i :class="isEditMode ? 'fas fa-save' : 'fas fa-map-marked-alt'" class="me-2"></i>
                            {{ isEditMode ? 'ACTUALIZAR TIENDA' : 'COLOCAR EN MAPA' }}
                        </button>
                    </div>
                </div>

                <!--  GESTIN DE TIENDAS -->
                <div v-if="view === 'manage'" class="manage-container">
                    <div v-if="shops.length === 0" class="empty-state">
                        <div class="empty-icon"><i class="fas fa-ghost"></i></div>
                        <h3>No hay tiendas creadas</h3>
                        <p>Crea tu primera tienda para comenzar</p>
                        <button class="btn-create-first" @click="resetCreator">
                            <i class="fas fa-plus me-2"></i> Crear Primera Tienda
                        </button>
                    </div>

                    <div class="shops-grid" v-else>
                        <div class="shop-card" v-for="shop in shops">
                            <div class="shop-header">
                                <div class="shop-icon">
                                    <i
                                        :class="'fas ' + (shopTypes.find(t => t.value === shop.type)?.icon || 'fa-store')"></i>
                                </div>
                                <div class="shop-info">
                                    <h5 class="shop-name">{{ shop.name }}</h5>
                                    <div class="shop-meta">
                                        <span class="shop-type">{{ getTypeLabel(shop.type) }}</span>
                                        <span class="shop-items">{{ shop.items.length }} Items</span>
                                    </div>
                                </div>
                            </div>

                            <!--  BOTONES ACTUALIZADOS CON EDICIN -->
                            <div class="shop-actions">
                                <button class="shop-btn shop-btn-edit" @click="editShop(shop)">
                                    <i class="fas fa-edit"></i> Editar
                                </button>
                                <button class="shop-btn shop-btn-teleport" @click="teleport(shop)">
                                    <i class="fas fa-location-arrow"></i> Ir
                                </button>
                                <button class="shop-btn shop-btn-delete" @click="deleteShop(shop)">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.2/dist/axios.min.js"></script>
    <script src="app.js"></script>
</body>

</html>